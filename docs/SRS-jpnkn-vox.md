# ソフトウェア要件仕様書 (SRS)：JPNKN Vox for Android

## 1. プロジェクト概要
外配信（IRL配信）において、配信者がコメントを「耳」と「目」の両方でリアルタイムに確認できる環境を提供するため、バックグラウンド動作に特化した jpnkn 専用読み上げ・表示アプリケーションを開発する。

## 2. 背景と目的
* **課題**: ブラウザベースのツールでは、Android の省電力仕様によるサスペンド（通信・処理の停止）を回避できず、外配信中に読み上げが途切れる致命的な問題がある。
* **解決策**: OS の「Foreground Service」と「Overlay UI」を活用したネイティブアプリを構築し、画面消灯時や他アプリ使用時でも確実に動作するインフラを構築する。

## 3. 機能要件

### 3.1 接続・通信機能
* **WebSocket 接続**: jpnkn サーバーと常時接続し、リアルタイムでコメントを受信する。
* **自動再接続**: 移動中のネットワーク切り替え（4G/5G/Wi-Fi）による切断時、指数バックオフアルゴリズム等を用いて自動復旧する。
* **接続管理**: 配信 ID や接続 URL の保存、起動時の自動接続機能。

### 3.2 音声合成（TTS）機能
* **ネイティブ TTS 利用**: Android 標準の `TextToSpeech` API を使用。
* **読み上げ制御**: 速度、ピッチ、音量の調整。
* **フィルタリング**: 記号・URL のスキップ、NG ワード設定。
* **キュー制御**: 大量連投時のバッファ管理と、古い未読コメントの自動スキップ機能。

### 3.3 表示機能 (UI/UX)
* **メイン画面ログ**: アプリ内で受信コメントを時系列リストで表示。
* **オーバーレイ表示 (Overlay)**: `SYSTEM_ALERT_WINDOW` 権限を利用し、配信アプリ等の他アプリ上に最新コメントを重ねて表示する。
* **ステータスインジケーター**: 接続状態（接続済み/切断/再試行中）を視認性の高い色やアイコンで表示。
* **視認性最適化**: 屋外での利用を想定し、高コントラストな配色とフォントサイズの変更機能。

### 3.4 バックグラウンド・運用機能
* **Foreground Service**: サービスを常駐させ、通知を表示することで OS によるタスクキルを防止。
* **通知コントロール**: 通知領域から「読み上げ/表示の開始・停止」を直接操作。
* **Audio Focus 管理**: 配信アプリ等とのオーディオ競合を適切に処理。

## 4. 非機能要件
* **可用性**: 画面消灯およびバックグラウンド状態での動作継続性。
* **省電力性**: 画面輝度抑制や通信最適化によるバッテリー消費の最小化。
* **耐障害性**: ネットワーク瞬断時もクラッシュせず、自動で待機・復旧すること。

## 5. 推奨技術スタック
* **言語**: Kotlin
* **UI**: Jetpack Compose
* **オーバーレイ**: `WindowManager` + Compose View
* **通信**: OkHttp / Scarlet (WebSocket)
* **常駐処理**: Android Foreground Service
* **音声**: `android.speech.tts.TextToSpeech`

## 6. リスク・留意事項
* **メーカー固有設定**: OPPO, Xiaomi 等の強力なタスクキル設定への対策（設定誘導 UI の実装）。
* **権限許可**: オーバーレイ表示に必要な「他のアプリの上に重ねて表示」権限のユーザー許諾。